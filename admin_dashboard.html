<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel do Gestor - ERP</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="icon" type="image/png" href="assets/favicon.png">
</head>

<body>

    <nav class="sidebar">
        <div class="sidebar-header">
            <img src="assets/logo.png" alt="" width="100%" height="auto">
            <p id="admin-name">Carregando...</p>
        </div>
        <ul class="nav-links">
            <li onclick="showSection('dashboard')" class="active">
                <i class="material-icons">dashboard</i> Vis√£o Geral
            </li>
            <li onclick="showSection('colaboradores')">
                <i class="material-icons">people</i> Colaboradores
            </li>
            <li onclick="showSection('lancamentos')">
                <i class="material-icons">assessment</i> Lan√ßar Desempenho
            </li>
            <li onclick="showSection('ocorrencias')">
                <i class="material-icons">feedback</i> Nova Ocorr√™ncia
            </li>
            <li onclick="logout()" class="logout-btn">
                <i class="material-icons">logout</i> Sair
            </li>
        </ul>
    </nav>

    <main class="main-content">

        <div id="section-dashboard" class="section">
            <div class="header-flex">
                <div>
                    <h1>Vis√£o Geral da Equipe (Acumulado)</h1>
                    <p style="color: #666; font-size: 13px; margin-top: 5px;">
                        M√©dias e somat√≥rios de todo o per√≠odo hist√≥rico.
                    </p>
                </div>

                <button onclick="forceDashboardRefresh()" class="btn-primary" title="Recalcular Dados"
                    style="padding: 10px 15px;">
                    <i class="material-icons" style="font-size: 20px; vertical-align: middle;">sync</i>
                </button>
            </div>

            <div class="metrics-grid">
                <div class="metrics-grid">
    
    <div class="metric-card kpi-card" onclick="openDetailModal('team-tel')" style="border-left: 5px solid #007bff;">
        <h3>üìû TMA M√©dio (Equipe Tel)</h3>
        <h1 id="kpi-team-tel">--:--</h1>
        <p>Clique para ver detalhes</p>
    </div>

    <div class="metric-card kpi-card" onclick="openDetailModal('team-chat')" style="border-left: 5px solid #17a2b8;">
        <h3>üí¨ TMA M√©dio (Equipe Chat)</h3>
        <h1 id="kpi-team-chat">--:--</h1>
        <p>Clique para ver detalhes</p>
    </div>

    <div class="metric-card kpi-card" onclick="openDetailModal('team-vol')" style="border-left: 5px solid #6f42c1;">
        <h3>‚úÖ M√©dia Finalizados</h3>
        <h1 id="kpi-team-vol">0</h1>
        <p>M√©dia de chamados por agente</p>
    </div>

    <div class="metric-card kpi-card" onclick="openDetailModal('best-qa')" style="border-left: 5px solid #28a745;">
        <h3>üèÜ Melhor Monitoria</h3>
        <h1 id="kpi-best-qa">--</h1>
        <p id="kpi-best-qa-name" style="color: #28a745; font-weight:bold;">--</p>
    </div>

    <div class="metric-card kpi-card" onclick="openDetailModal('max-tel')" style="border-left: 5px solid #dc3545;">
        <h3>‚ö†Ô∏è Maior TMA (Tel)</h3>
        <h1 id="kpi-max-tel">--:--</h1>
        <p id="kpi-max-tel-name" style="color: #dc3545; font-weight:bold;">--</p>
    </div>

    <div class="metric-card kpi-card" onclick="openDetailModal('max-chat')" style="border-left: 5px solid #dc3545;">
        <h3>‚ö†Ô∏è Maior TMA (Chat)</h3>
        <h1 id="kpi-max-chat">--:--</h1>
        <p id="kpi-max-chat-name" style="color: #dc3545; font-weight:bold;">--</p>
    </div>
</div>
</div>

            <br>
            <hr><br>

            <div class="charts-container" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="metric-card">
                    <h3>Ranking de Qualidade (Monitoria)</h3>
                    <canvas id="adminChartMonitoria"></canvas>
                </div>
                <div class="metric-card">
                    <h3>Distribui√ß√£o de Volume (Telefonia vs Huggy)</h3>
                    <canvas id="adminChartVolume"></canvas>
                </div>
            </div>
        </div>

        <div id="modal-kpi-details" class="modal">
            <div class="modal-content">
                <span class="close"
                    onclick="document.getElementById('modal-kpi-details').style.display='none'">&times;</span>
                <h2 id="modal-kpi-title">Detalhes</h2>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Colaborador</th>
                            <th id="modal-kpi-col-value">Valor</th>
                        </tr>
                    </thead>
                    <tbody id="modal-kpi-body"></tbody>
                </table>
            </div>
        </div>

        <div id="section-colaboradores" class="section" style="display:none;">
            <div class="header-flex">
                <h1>Colaboradores</h1>
                <button onclick="openModal()" class="btn-primary">+ Novo Colaborador</button>
            </div>

            <table class="data-table">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Cargo</th>
                        <th>Departamento</th>
                        <th>Status</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="colaboradores-list">
                </tbody>
            </table>
        </div>

        <div id="section-lancamentos" class="section" style="display:none;">
            <h1>Lan√ßamento de Desempenho Semanal</h1>

            <form id="form-metrics" class="metrics-form">

                <div class="form-group-header">
                    <div class="input-block">
                        <label>Colaborador</label>
                        <select id="metric-user-select" required>
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                    <div class="input-block">
                        <label>In√≠cio da Semana (Segunda-feira)</label>
                        <input type="date" id="metric-date" required>
                    </div>
                </div>

                <hr>

                <div class="metrics-grid">

                    <div class="metric-card">
                        <h3>Geral</h3>
                        <label>Atendimentos Abertos</label>
                        <input type="number" id="at-abertos" min="0" required>

                        <label>Atendimentos Finalizados</label>
                        <input type="number" id="at-finalizados" min="0" required>
                    </div>

                    <div class="metric-card">
                        <h3>Telefonia</h3>
                        <label>Liga√ß√µes Realizadas (Atendidas)</label>
                        <input type="number" id="lig-realizadas" min="0">

                        <label>Liga√ß√µes Recebidas (Atendidas)</label>
                        <input type="number" id="lig-recebidas" min="0">

                        <label>Liga√ß√µes Perdidas</label>
                        <input type="number" id="lig-perdidas" min="0">

                        <label>TME (minutos)</label>
                        <input type="number" step="0.01" id="tme-tel" placeholder="0.00">

                        <label>TMA (minutos)</label>
                        <input type="number" step="0.01" id="tma-tel" placeholder="0.00">
                    </div>

                    <div class="metric-card">
                        <h3>Digital & Qualidade</h3>
                        <label>Atendimentos Huggy</label>
                        <input type="number" id="at-huggy" min="0">

                        <label>TMA Huggy (minutos)</label>
                        <input type="number" step="0.01" id="tma-huggy" placeholder="0.00">

                        <label class="highlight-label">Nota de Monitoria (0-100)</label>
                        <input type="number" step="0.1" id="nota-monitoria" max="100" placeholder="100">
                    </div>
                </div>

                <button type="submit" class="btn-save-metrics">Salvar M√©tricas da Semana</button>
            </form>
        </div>

        <div id="section-ocorrencias" class="section" style="display:none;">
            <h1>Registrar Ocorr√™ncia / Feedback</h1>

            <form id="form-ocorrencias" class="metrics-form">

                <div class="form-group-header">
                    <div class="input-block">
                        <label>Colaborador</label>
                        <select id="occur-user-select" required>
                            <option value="">Carregando...</option>
                        </select>
                    </div>
                    <div class="input-block">
                        <label>Data do Fato</label>
                        <input type="date" id="occur-date" required>
                    </div>
                </div>

                <div class="input-block">
                    <label>Tipo de Ocorr√™ncia</label>
                    <div class="radio-group">
                        <label class="radio-label positive">
                            <input type="radio" name="occur-type" value="positive" required>
                            <span>üëç Positiva (Elogio/M√©rito)</span>
                        </label>
                        <label class="radio-label negative">
                            <input type="radio" name="occur-type" value="negative">
                            <span>üëé Negativa (Advert√™ncia/Falha)</span>
                        </label>
                    </div>
                </div>

                <br>

                <div class="input-block">
                    <label>T√≠tulo Resumido</label>
                    <input type="text" id="occur-title" placeholder="Ex: Atraso injustificado" required>
                </div>

                <div class="input-block">
                    <label>Descri√ß√£o Detalhada</label>
                    <textarea id="occur-desc" rows="5" placeholder="Descreva o que aconteceu..."
                        style="padding:10px; width:100%; box-sizing:border-box; border:1px solid #ddd; border-radius:4px;"></textarea>
                </div>

                <button type="submit" class="btn-save-metrics" style="background-color: #6610f2;">Registrar
                    Feedback</button>
            </form>
        </div>
    </main>

    <div id="modal-new-user" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>Novo Colaborador</h2>
            <form id="form-add-user">
                <input type="text" id="new-name" placeholder="Nome Completo" required>
                <input type="email" id="new-email" placeholder="E-mail Corporativo" required>
                <input type="text" id="new-cargo" placeholder="Cargo (ex: Atendente)" required>
                <input type="text" id="new-dept" placeholder="Departamento" required>
                <p style="font-size: 12px; color: #666;">A senha padr√£o ser√°: <b>mudar123</b></p>
                <button type="submit">Cadastrar</button>
            </form>
        </div>
    </div>

    <div id="modal-user-history" class="modal">
        <div class="modal-content" style="width: 80%; max-width: 900px;">
            <span class="close" onclick="closeHistoryModal()">&times;</span>
            <h2 id="history-user-name">Hist√≥rico do Colaborador</h2>

            <div style="display: flex; gap: 20px; flex-wrap: wrap;">

                <div style="flex: 1; min-width: 300px;">
                    <h3>üìä M√©tricas Semanais</h3>
                    <div id="history-metrics-list" class="history-list">
                        <p>Carregando...</p>
                    </div>
                </div>

                <div style="flex: 1; min-width: 300px;">
                    <h3>üí¨ Ocorr√™ncias / Feedbacks</h3>
                    <div id="history-occurrences-list" class="history-list">
                        <p>Carregando...</p>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script type="module" src="js/admin.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>

</html>